<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-spring4-4.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.thymeleaf.org ">

<head>
  <script th:src="@{/js/jquery-3.6.0.min.js}"></script>
  <script th:src="@{/js/bootstrap.js}"></script>
  <link rel="stylesheet" th:href="@{/css/bootstrap.css}"/>

  <meta charset="UTF-8">
  <title>Transactions</title>

</head>
<body>

<script th:inline="javascript">
  /*<![CDATA[*/
  $(document).ready(function () {
    $('form#monthSelector').submit(function (event) {
      event.preventDefault();
      let monthNumber = Number(document.getElementById("month").value);

      let transactions = /*[[${transactions}]]*/ [];
      let monthlyReward = 0;
      for (let i = 0; i < transactions.length; i++) {
        let transactionDate = new Date(transactions[i].transactionDate + "T00:00:00");
        console.log("transaction num: " + i + " transaction date " + transactionDate.getMonth());
        console.log("month number" + typeof monthNumber);
        if (transactionDate.getMonth() === monthNumber) {

          monthlyReward = monthlyReward + transactions[i].reward;
        }
      }
      let monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August',
        'September', 'October', 'November', 'December'];
      document.getElementById("monthlyReward").innerHTML = "Reward earned for the month of "
          + monthNames[monthNumber] +
          " is " + monthlyReward + " points";
    });
  });
</script>
<div class="container">
  <h1>Transactions for <span th:text="${customerName}"/></h1>

  <div class="panel-body">
    <h4>Add new Transactions</h4>
    <form class="form-horizontal" method="post" th:action="@{/transactions/addTransaction}" id="newTransactionForm">
      <div class="form-group">
        <label class="col-sm-2 control-label" for="customerId">Customer Id:</label>
        <div class="col-sm-10">
          <input class="form-control" type="text" th:name="customerId" id="customerId" th:value="${customerId}">
        </div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label" for="transactionDate">Transaction Date:</label>
        <div class="col-sm-10">
          <input class="form-control" type="date" th:name="transactionDate" id="transactionDate"/>
        </div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label" for="transactionAmount">Transaction Amount:</label>
        <div class="col-sm-10">
          <input class="form-control" type="number" th:name="transactionAmount" id="transactionAmount"/>
        </div>
      </div>
      <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
          <input type="submit" id="addNewTransactionButton" name="addNewTransactionButton" value="Submit"/>
        </div>
      </div>
    </form>

    <p/>
    <h4>Monthly Reward</h4>
    <form class="form-horizontal" id="monthSelector">
      <div class="form-group">
        <label class="col-sm-2 control-label" for="month">Select Month:</label>
        <div class="col-sm-10">
          <select class="form-control" id="month">
            <option value="0">January</option>
            <option value="1">February</option>
            <option value="2">March</option>
            <option value="3">April</option>
            <option value="4">May</option>
            <option value="5">June</option>
            <option value="6">July</option>
            <option value="7">August</option>
            <option value="8">September</option>
            <option value="9">October</option>
            <option value="10">November</option>
            <option value="11">December</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
          <input type="submit" value="Submit"/>
        </div>
      </div>
    </form>

    <p id="monthlyReward"></p>

    <table class="table">
      <thead>
      <tr>
        <th>id</th>
        <th>Transaction Date</th>
        <th>Transaction Amount</th>
        <th>Reward Earned</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="transaction : ${transactions}">
        <td th:text="${transaction.id}"></td>
        <td th:text="${transaction.transactionDate}"/>
        <td th:text="${transaction.transactionAmount}"/>
        <td th:text="${transaction.reward}"/>
      </tr>
      </tbody>
    </table>
  </div>
</div>
</body>
</html>